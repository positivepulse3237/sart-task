<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SART Task Experiment</title>
    
    <script src="https://unpkg.com/jspsych@7.3.4/jspsych.js"></script>
    
    <link href="https://unpkg.com/jspsych@7.3.4/css/jspsych.css" rel="stylesheet" type="text/css" />

    <script src="https://unpkg.com/jspsych@7.3.4/plugin-html-keyboard-response.js"></script>
    <script src="https://unpkg.com/jspsych@7.3.4/plugin-preload.js"></script>
    
    <style>
        /* Optional: Make background black as seen in your screenshot */
        body { background-color: black; color: white; }
    </style>
</head>
<body>
    <div id="jspsych-target"></div>

    <script>
        // ------------------------------------------
        // YOUR EXPERIMENT CODE GOES HERE
        // ------------------------------------------
        
        // 1. Initialize jsPsych
        const jsPsych = initJsPsych({
            on_finish: function() {
                // When experiment ends, save the data!
                saveData(jsPsych.data.get().csv());
            }
        });

        // 2. Define your timeline (SART task logic)
        // (Paste your specific SART experiment code here)
        var timeline = [];

        var welcome = {
            type: jsPsychHtmlKeyboardResponse,
            stimulus: "Welcome to the experiment. Press any key to begin."
        };
        timeline.push(welcome);

        // 3. The Save Function (Connects to your GitHub/Vercel backend)
        async function saveData(dataContent) {
            const subjectId = "User_" + Date.now();
            // Combine ID with the CSV data
            const finalData = `\n--- New Session ${subjectId} ---\n` + dataContent;

            const statusMsg = document.createElement('p');
            statusMsg.innerText = "Saving data...";
            document.body.appendChild(statusMsg);

            try {
                await fetch('/api/save', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ content: finalData })
                });
                statusMsg.innerText = "Data Saved!";
            } catch (e) {
                statusMsg.innerText = "Error saving data.";
            }
        }

        // 4. Run the experiment
        jsPsych.run(timeline);
    </script>
</body>
</html>
